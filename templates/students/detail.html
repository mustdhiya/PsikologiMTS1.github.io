{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Detail Siswa - {{ student.name }}{% endblock %}

{% block extra_css %}
<style>
/* ==================== ANIMATIONS ==================== */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
.animate-slideInLeft { animation: slideInLeft 0.5s ease-out forwards; }

/* ==================== CARDS ==================== */
.detail-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid rgba(226, 232, 240, 0.5);
}

.detail-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* ==================== PROGRESS BAR ==================== */
.progress-bar-custom {
    height: 10px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    transition: width 0.5s ease;
}

/* ==================== STATUS BADGE ==================== */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.pending {
    background: #fef3c7;
    color: #92400e;
}

.status-badge.in-progress {
    background: #dbeafe;
    color: #1e40af;
}

.status-badge.completed {
    background: #d1fae5;
    color: #065f46;
}

.status-badge.edited {
    background: #fce7f3;
    color: #831843;
}

/* ==================== ICON CIRCLE ==================== */
.icon-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    flex-shrink: 0;
}

/* ==================== RMIB SECTION ==================== */
.rmib-section {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border: 2px solid rgba(99, 102, 241, 0.2);
    border-radius: 16px;
    padding: 24px;
}

/* ==================== INFO BOX ==================== */
.info-box {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border-left: 4px solid #3b82f6;
    border-radius: 8px;
    padding: 16px;
}

/* ==================== STAT BOX ==================== */
.stat-box {
    text-align: center;
    padding: 16px;
    background: white;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.stat-box .value {
    font-size: 28px;
    font-weight: 700;
    color: #3b82f6;
}

.stat-box .label {
    font-size: 12px;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 6px;
}

/* ==================== BUTTON STYLES ==================== */
.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.btn-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .icon-circle {
        width: 50px;
        height: 50px;
        font-size: 24px;
    }
    
    .detail-card {
        padding: 16px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- ==================== HEADER SECTION ==================== -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-xl p-8 mb-8 text-white animate-fadeInUp">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-6">
                <!-- Profile Picture -->
                <div class="w-24 h-24 lg:w-32 lg:h-32 rounded-full bg-white/20 backdrop-blur-lg flex items-center justify-center">
                    <i class="fas fa-user text-4xl lg:text-5xl"></i>
                </div>
                
                <!-- Student Info -->
                <div>
                    <h1 class="text-3xl lg:text-4xl font-bold mb-2">{{ student.name }}</h1>
                    <p class="text-indigo-100 text-lg">{{ student.get_class_display }}</p>
                    <div class="flex gap-6 mt-3 text-indigo-100">
                        <span><i class="fas fa-id-card mr-2"></i>{{ student.nisn }}</span>
                        <span><i class="fas fa-mars-and-venus mr-2"></i>{{ student.get_gender_display }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Status Badge -->
            <div>
                <span class="status-badge {% if student.test_status == 'pending' %}pending{% elif student.test_status == 'in_progress' %}in-progress{% else %}completed{% endif %}">
                    {% if student.test_status == 'pending' %}
                    <i class="fas fa-hourglass-start"></i> Belum Tes
                    {% elif student.test_status == 'in_progress' %}
                    <i class="fas fa-spinner fa-spin"></i> Sedang Tes
                    {% else %}
                    <i class="fas fa-check-circle"></i> Selesai
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- ==================== PERSONAL DATA SECTION ==================== -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Basic Info -->
        <div class="detail-card p-6 animate-slideInLeft">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-user text-indigo-600 mr-2"></i>Data Pribadi
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Tempat/Tanggal Lahir</p>
                    <p class="text-gray-900 mt-1">{{ student.birth_place }}, {{ student.birth_date|date:"d M Y" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Jenis Kelamin</p>
                    <p class="text-gray-900 mt-1">{{ student.get_gender_display }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Tahun Masuk</p>
                    <p class="text-gray-900 mt-1">{{ student.entry_year }}</p>
                </div>
            </div>
        </div>

        <!-- Contact Info -->
        <div class="detail-card p-6 animate-slideInLeft" style="animation-delay: 0.1s;">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-phone text-indigo-600 mr-2"></i>Kontak
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Nomor Ponsel</p>
                    <p class="text-gray-900 mt-1">{{ student.phone|default:"Tidak Ada" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Ponsel Orang Tua</p>
                    <p class="text-gray-900 mt-1">{{ student.parent_phone|default:"Tidak Ada" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Alamat</p>
                    <p class="text-gray-900 mt-1 text-sm">{{ student.address|default:"Tidak Ada" }}</p>
                </div>
            </div>
        </div>

        <!-- Academic Info -->
        <div class="detail-card p-6 animate-slideInLeft" style="animation-delay: 0.2s;">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-graduation-cap text-indigo-600 mr-2"></i>Akademik
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Kelas</p>
                    <p class="text-gray-900 mt-1 text-lg font-bold">{{ student.student_class }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">NISN</p>
                    <p class="text-gray-900 mt-1 font-mono">{{ student.nisn }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Status Tes</p>
                    <p class="mt-1">
                        <span class="status-badge {% if student.test_status == 'pending' %}pending{% elif student.test_status == 'in_progress' %}in-progress{% else %}completed{% endif %}" style="display: inline-flex;">
                            {% if student.test_status == 'pending' %}
                            Belum Tes
                            {% elif student.test_status == 'in_progress' %}
                            Sedang Tes
                            {% else %}
                            Selesai
                            {% endif %}
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== AUTHENTICATION & ACCOUNT SECTION ==================== -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-8">
        <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-lock text-red-600 mr-3"></i>
                Akun & Autentikasi
            </h2>
            <span class="px-4 py-2 rounded-full text-sm font-semibold {% if student.is_locked %}bg-red-500 text-white{% else %}bg-green-500 text-white{% endif %}">
                {% if student.is_locked %}
                    <i class="fas fa-lock mr-1"></i>Terkunci
                {% else %}
                    <i class="fas fa-unlock-alt mr-1"></i>Aktif
                {% endif %}
            </span>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- User Account Info -->
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                <p class="text-xs text-blue-600 font-semibold uppercase tracking-wide mb-2">Status Akun Django</p>
                {% if student.user %}
                    <p class="text-gray-900 font-semibold mb-3">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>Terdaftar
                    </p>
                    <div class="space-y-3 text-sm bg-white rounded p-3 border border-blue-200">
                        <div>
                            <strong class="text-gray-700">Username:</strong>
                            <br>
                            <span class="font-mono bg-gray-100 px-2 py-1 rounded text-xs inline-block mt-1">{{ student.user.username }}</span>
                        </div>
                        <div>
                            <strong class="text-gray-700">Email:</strong>
                            <br>
                            <span class="font-mono bg-gray-100 px-2 py-1 rounded text-xs break-all inline-block mt-1">{{ student.user.email }}</span>
                        </div>
                        <div>
                            <strong class="text-gray-700">Nama Lengkap:</strong>
                            <br>
                            <span class="text-gray-600">{{ student.user.first_name }} {{ student.user.last_name|default:"" }}</span>
                        </div>
                        <div>
                            <strong class="text-gray-700">Dibuat:</strong>
                            <br>
                            <span class="text-gray-600">{{ student.user.date_joined|date:"d M Y, H:i" }} WIB</span>
                        </div>
                        <div>
                            <strong class="text-gray-700">Status Aktif:</strong>
                            <br>
                            <span class="text-gray-600">
                                {% if student.user.is_active %}
                                <i class="fas fa-check-circle text-green-600 mr-1"></i>Ya
                                {% else %}
                                <i class="fas fa-times-circle text-red-600 mr-1"></i>Tidak
                                {% endif %}
                            </span>
                        </div>
                    </div>
                {% else %}
                    <p class="text-gray-600 italic">
                        <i class="fas fa-times-circle text-red-600 mr-2"></i>Belum membuat akun
                    </p>
                {% endif %}
            </div>

            <!-- Password Info -->
            <div class="{% if student.is_locked %}bg-red-50 border-l-4 border-red-500{% elif student.generated_password %}bg-green-50 border-l-4 border-green-500{% else %}bg-yellow-50 border-l-4 border-yellow-500{% endif %} rounded-lg p-4">
                <p class="text-xs {% if student.is_locked %}text-red-600{% elif student.generated_password %}text-green-600{% else %}text-yellow-600{% endif %} font-semibold uppercase tracking-wide mb-2">
                    Password Tergenerate
                </p>
                {% if student.generated_password %}
                    <div class="bg-white border-2 {% if student.is_locked %}border-red-300{% else %}border-green-300{% endif %} rounded px-4 py-3 mb-3 font-mono text-lg font-bold text-center tracking-wider break-all">
                        <span id="passwordDisplay">{{ student.generated_password }}</span>
                    </div>
                    <p class="text-xs text-gray-600 mb-3">
                        <i class="fas fa-info-circle mr-1"></i>
                        {% if student.password_changed %}
                        <strong>✓ Password sudah diubah oleh siswa</strong>
                        {% else %}
                        <strong>⚠ Siswa belum mengubah password default</strong>
                        {% endif %}
                    </p>
                    <div class="flex gap-2">
                        <button onclick="copyPassword()" class="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded transition-colors">
                            <i class="fas fa-copy mr-1"></i>Copy
                        </button>
                        <button onclick="resetPasswordConfirm()" class="flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-bold rounded transition-colors">
                            <i class="fas fa-redo mr-1"></i>Reset
                        </button>
                    </div>
                {% else %}
                    <p class="text-gray-600 italic mb-3">
                        <i class="fas fa-exclamation-circle mr-1"></i>Belum di-generate
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Login Attempts & Lock Status -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
            <!-- Login Attempts -->
            <div class="{% if student.login_attempts >= 3 %}bg-yellow-50 border-l-4 border-yellow-500{% else %}bg-blue-50 border-l-4 border-blue-500{% endif %} rounded-lg p-4">
                <p class="text-xs {% if student.login_attempts >= 3 %}text-yellow-600{% else %}text-blue-600{% endif %} font-semibold uppercase tracking-wide mb-2">Percobaan Login Gagal</p>
                <p class="text-3xl font-bold text-gray-900 mb-2">{{ student.login_attempts }}<span class="text-lg text-gray-600">/5</span></p>
                <div class="w-full bg-gray-300 rounded-full h-2 overflow-hidden mb-2">
                    <div class="bg-gradient-to-r {% if student.login_attempts >= 5 %}from-red-500 to-red-600{% elif student.login_attempts >= 3 %}from-yellow-500 to-yellow-600{% else %}from-green-500 to-green-600{% endif %} h-2" style="width: {{ student.login_attempts }}0%"></div>
                </div>
                {% if student.login_attempts >= 3 %}
                <p class="text-xs text-yellow-700"><i class="fas fa-exclamation-triangle mr-1"></i>Mendekati batas kunci</p>
                {% else %}
                <p class="text-xs text-blue-700"><i class="fas fa-check-circle mr-1"></i>Status aman</p>
                {% endif %}
            </div>

            <!-- Account Lock Status -->
            <div class="{% if student.is_locked %}bg-red-50 border-l-4 border-red-500{% else %}bg-green-50 border-l-4 border-green-500{% endif %} rounded-lg p-4">
                <p class="text-xs {% if student.is_locked %}text-red-600{% else %}text-green-600{% endif %} font-semibold uppercase tracking-wide mb-2">Status Akun</p>
                <p class="text-lg font-bold text-gray-900 mb-3">
                    {% if student.is_locked %}
                    <i class="fas fa-lock text-red-600 mr-2"></i>
                    <span class="text-red-700">Terkunci</span>
                    {% else %}
                    <i class="fas fa-unlock-alt text-green-600 mr-2"></i>
                    <span class="text-green-700">Aktif</span>
                    {% endif %}
                </p>
                <p class="text-xs text-gray-600 mb-2">
                    {% if student.is_locked %}
                    <i class="fas fa-exclamation-triangle text-red-600 mr-1"></i>Akun terkunci karena banyak percobaan login gagal
                    {% else %}
                    <i class="fas fa-check-circle text-green-600 mr-1"></i>Akun berfungsi normal
                    {% endif %}
                </p>
                {% if student.is_locked %}
                <button onclick="unlockAccountConfirm()" class="w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded transition-colors">
                    <i class="fas fa-unlock mr-1"></i>Buka Kunci
                </button>
                {% endif %}
            </div>

            <!-- Last Login Attempt -->
            <div class="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-4">
                <p class="text-xs text-purple-600 font-semibold uppercase tracking-wide mb-2">Percobaan Terakhir</p>
                {% if student.last_login_attempt %}
                <p class="text-sm font-semibold text-gray-900">{{ student.last_login_attempt|date:"d M Y" }}</p>
                <p class="text-sm text-gray-600">Pukul {{ student.last_login_attempt|date:"H:i" }} WIB</p>
                <p class="text-xs text-purple-600 mt-2">
                    <i class="fas fa-history mr-1"></i>
                    {% with days_ago=student.last_login_attempt|timesince %}
                    {{ days_ago }} yang lalu
                    {% endwith %}
                </p>
                {% else %}
                <p class="text-sm text-gray-600 italic">
                    <i class="fas fa-inbox mr-1"></i>Belum ada
                </p>
                {% endif %}
            </div>
        </div>

        <!-- Additional Account Information -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <!-- Password Status -->
            <div class="{% if student.password_changed %}bg-green-50 border-l-4 border-green-500{% else %}bg-orange-50 border-l-4 border-orange-500{% endif %} rounded-lg p-4">
                <p class="text-xs {% if student.password_changed %}text-green-600{% else %}text-orange-600{% endif %} font-semibold uppercase tracking-wide mb-2">Status Password</p>
                <p class="text-lg font-bold text-gray-900 mb-2">
                    {% if student.password_changed %}
                    <i class="fas fa-check-circle text-green-600 mr-2"></i>
                    <span class="text-green-700">Sudah Diubah</span>
                    {% else %}
                    <i class="fas fa-exclamation-circle text-orange-600 mr-2"></i>
                    <span class="text-orange-700">Masih Default</span>
                    {% endif %}
                </p>
                <p class="text-xs text-gray-600">
                    {% if student.password_changed %}
                    Siswa telah mengubah password default mereka
                    {% else %}
                    Siswa belum mengubah password yang dibuat sistem
                    {% endif %}
                </p>
            </div>

            <!-- Account Created Duration -->
            <div class="bg-indigo-50 border-l-4 border-indigo-500 rounded-lg p-4">
                <p class="text-xs text-indigo-600 font-semibold uppercase tracking-wide mb-2">Durasi Akun</p>
                <p class="text-lg font-bold text-gray-900 mb-2">
                    {% if student.user %}
                        {% with days_created=student.user.date_joined|timesince %}
                        <i class="fas fa-calendar-check text-indigo-600 mr-2"></i>
                        {{ days_created }} yang lalu
                        {% endwith %}
                    {% else %}
                        <i class="fas fa-times-circle text-red-600 mr-2"></i>Belum ada akun
                    {% endif %}
                </p>
                <p class="text-xs text-gray-600">
                    {% if student.user %}
                    Akun dibuat sejak {{ student.user.date_joined|date:"d F Y" }}
                    {% else %}
                    Akun django belum dibuat untuk siswa ini
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Account Actions -->
        <div class="flex flex-wrap gap-3 pt-4 border-t-2 border-gray-200">
            {% if student.user %}
            <button onclick="resetPasswordConfirm()" class="px-6 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-redo mr-2"></i>Reset Password
            </button>
            {% endif %}
            
            {% if student.is_locked %}
            <button onclick="unlockAccountConfirm()" class="px-6 py-2.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-unlock mr-2"></i>Buka Kunci Akun
            </button>
            {% endif %}

            <a href="{% url 'students:update' student.pk %}" class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-edit mr-2"></i>Edit Data
            </a>
        </div>
    </section>

    <!-- ==================== SYSTEM INFO SECTION ==================== -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-8">
        <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-info-circle text-blue-600 mr-3"></i>
            Informasi Sistem
        </h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Created Info -->
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                <p class="text-xs text-blue-600 font-semibold uppercase tracking-wide mb-1">Tanggal Ditambahkan</p>
                <p class="text-lg font-bold text-gray-900">{{ student.created_at|date:"d F Y" }}</p>
                <p class="text-sm text-gray-600">Pukul {{ student.created_at|date:"H:i" }} WIB</p>
            </div>

            <!-- Updated Info -->
            <div class="bg-indigo-50 border-l-4 border-indigo-500 rounded-lg p-4">
                <p class="text-xs text-indigo-600 font-semibold uppercase tracking-wide mb-1">Terakhir Diubah</p>
                <p class="text-lg font-bold text-gray-900">{{ student.updated_at|date:"d F Y" }}</p>
                <p class="text-sm text-gray-600">Pukul {{ student.updated_at|date:"H:i" }} WIB</p>
            </div>

            <!-- Test Date -->
            <div class="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-4">
                <p class="text-xs text-purple-600 font-semibold uppercase tracking-wide mb-1">Waktu Mulai Tes</p>
                {% if student.test_date %}
                <p class="text-lg font-bold text-gray-900">{{ student.test_date|date:"d F Y" }}</p>
                <p class="text-sm text-gray-600">Pukul {{ student.test_date|date:"H:i" }} WIB</p>
                {% else %}
                <p class="text-sm text-gray-600 italic">Belum ada</p>
                {% endif %}
            </div>

            <!-- Password Changed Status -->
            <div class="{% if student.password_changed %}bg-green-50 border-l-4 border-green-500{% else %}bg-red-50 border-l-4 border-red-500{% endif %} rounded-lg p-4">
                <p class="text-xs {% if student.password_changed %}text-green-600{% else %}text-red-600{% endif %} font-semibold uppercase tracking-wide mb-1">Status Password</p>
                {% if student.password_changed %}
                <p class="text-lg font-bold text-green-700">
                    <i class="fas fa-check-circle mr-2"></i>Sudah Diubah
                </p>
                {% else %}
                <p class="text-lg font-bold text-red-700">
                    <i class="fas fa-exclamation-circle mr-2"></i>Masih Default
                </p>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- ==================== RMIB TEST SECTION ==================== -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                Tes RMIB (Rothwell Miller Interest Blank)
            </h2>
            <span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">
                Status: <span class="font-bold">{{ student.get_test_status_display }}</span>
            </span>
        </div>

        <!-- ==================== STATUS INDICATOR ==================== -->
        {% if student.test_status == 'pending' %}
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-clock text-yellow-600 text-2xl mt-1"></i>
                <div>
                    <h3 class="text-lg font-bold text-yellow-900 mb-2">Belum Memulai Tes</h3>
                    <p class="text-yellow-800 mb-4">
                        Siswa belum memulai tes RMIB. Klik tombol di bawah untuk memulai tes minat dan bakat.
                    </p>
                    <a href="{% url 'students:rmib_test' student.pk %}" 
                    class="inline-flex items-center px-6 py-2.5 btn-primary text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-play-circle mr-2"></i>
                        Mulai Tes RMIB
                    </a>
                </div>
            </div>
        </div>

        {% elif student.test_status == 'in_progress' %}
        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border-l-4 border-blue-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-spinner text-blue-600 text-2xl mt-1 animate-spin"></i>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-blue-900 mb-2">Sedang Mengerjakan Tes</h3>
                    <p class="text-blue-800 mb-4">
                        Siswa sedang mengerjakan tes RMIB. Progress otomatis tersimpan setiap 30 detik.
                    </p>
                    <a href="{% url 'students:rmib_test' student.pk %}" 
                    class="inline-flex items-center px-6 py-2.5 btn-primary text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-play-circle mr-2"></i>
                        Lanjutkan Tes
                    </a>
                </div>
            </div>
        </div>

        {% elif student.test_status == 'completed' %}
        <!-- ==================== COMPLETED STATE ==================== -->
        {% if student.rmib_result %}
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-check-circle text-green-600 text-2xl mt-1"></i>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-green-900 mb-1">Tes Selesai</h3>
                    <p class="text-green-800 text-sm">
                        Diselesaikan pada: <strong>{{ student.rmib_result.submitted_at|date:"d F Y, H:i" }} WIB</strong>
                        {% if student.rmib_result.edited_at %}
                        <br>Terakhir diedit: <strong>{{ student.rmib_result.edited_at|date:"d F Y, H:i" }} WIB</strong>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- ==================== RESULTS SUMMARY ==================== -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Total Score -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border-2 border-blue-200">
                <p class="text-xs font-semibold text-blue-600 uppercase tracking-wide mb-1">Total Skor</p>
                <p class="text-3xl font-bold text-blue-700">{{ student.rmib_result.total_score }}</p>
                <p class="text-xs text-blue-600 mt-1">dari 720 poin</p>
            </div>

            <!-- Primary Interest -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 border-2 border-yellow-200">
                <p class="text-xs font-semibold text-amber-600 uppercase tracking-wide mb-1">Minat Utama</p>
                <p class="text-2xl font-bold text-amber-700">Level {{ student.rmib_result.primary_level }}</p>
                <p class="text-xs text-amber-600 mt-1">{{ student.rmib_result.primary_level|multiply:5 }} poin</p>
            </div>

            <!-- Secondary Interest -->
            {% if student.rmib_result.secondary_level %}
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border-2 border-purple-200">
                <p class="text-xs font-semibold text-purple-600 uppercase tracking-wide mb-1">Minat Kedua</p>
                <p class="text-2xl font-bold text-purple-700">Level {{ student.rmib_result.secondary_level }}</p>
                <p class="text-xs text-purple-600 mt-1">{{ student.rmib_result.secondary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}

            <!-- Tertiary Interest -->
            {% if student.rmib_result.tertiary_level %}
            <div class="bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl p-4 border-2 border-pink-200">
                <p class="text-xs font-semibold text-pink-600 uppercase tracking-wide mb-1">Minat Ketiga</p>
                <p class="text-2xl font-bold text-pink-700">Level {{ student.rmib_result.tertiary_level }}</p>
                <p class="text-xs text-pink-600 mt-1">{{ student.rmib_result.tertiary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}
        </div>

        <!-- ==================== TOP 3 INTERESTS CARDS ==================== -->
        <div class="mb-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-medal text-yellow-500 mr-2"></i>
                Top 3 Minat Tertinggi
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Primary -->
                <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-lg p-4 border-2 border-yellow-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            1
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Utama</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:":1" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-yellow-700">{{ student.rmib_result.primary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-orange-600">{{ student.rmib_result.primary_level|multiply:5 }}</span>
                    </div>
                </div>

                <!-- Secondary -->
                {% if student.rmib_result.secondary_level %}
                <div class="bg-gradient-to-br from-gray-100 to-slate-100 rounded-lg p-4 border-2 border-gray-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-gray-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            2
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Kedua</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"1:2" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-gray-700">{{ student.rmib_result.secondary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-gray-600">{{ student.rmib_result.secondary_level|multiply:5 }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Tertiary -->
                {% if student.rmib_result.tertiary_level %}
                <div class="bg-gradient-to-br from-orange-100 to-amber-100 rounded-lg p-4 border-2 border-orange-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            3
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Ketiga</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"2:3" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-orange-700">{{ student.rmib_result.tertiary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-amber-600">{{ student.rmib_result.tertiary_level|multiply:5 }}</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ==================== ACTION BUTTONS ==================== -->
        <div class="flex flex-wrap gap-3 justify-start">
            <!-- View Results -->
            <a href="{% url 'students:rmib_result' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 btn-primary text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-eye mr-2"></i>
                Lihat Detail
            </a>

            <!-- Edit Results -->
            <a href="{% url 'students:rmib_edit_confirmation' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 btn-warning text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-edit mr-2"></i>
                Edit Hasil
            </a>

            <!-- Download Report -->
            <button onclick="alert('Fitur download report akan segera tersedia')" 
                    class="inline-flex items-center px-6 py-2.5 btn-success text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-download mr-2"></i>
                Download
            </button>

            <!-- Print -->
            <a href="{% url 'students:rmib_result' student.pk %}" target="_blank"
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-print mr-2"></i>
                Cetak
            </a>
        </div>

        {% else %}
        <!-- No Results Yet -->
        <div class="bg-gray-50 rounded-lg p-8 text-center border-2 border-dashed border-gray-300">
            <i class="fas fa-inbox text-gray-400 text-5xl mb-4"></i>
            <p class="text-gray-600 text-lg font-semibold mb-2">Belum Ada Hasil Tes</p>
            <p class="text-gray-500 mb-4">Hasil tes akan muncul setelah siswa menyelesaikan tes RMIB</p>
        </div>
        {% endif %}

        {% endif %}

        <!-- ==================== INFO BOX ==================== -->
        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mt-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-blue-600 text-lg mt-0.5"></i>
                <div>
                    <p class="text-sm text-blue-800">
                        <strong>Tentang RMIB:</strong> Tes RMIB (Rothwell Miller Interest Blank) adalah alat penilaian minat dan bakat siswa terhadap berbagai bidang pekerjaan. 
                        Gunakan hasil tes ini sebagai panduan dalam memilih jurusan dan karir di masa depan.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== RMIB RESULT SECTION ==================== -->
    {% if student.rmib_result %}
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-trophy text-yellow-500 mr-3"></i>
                Hasil Tes RMIB
            </h2>
            <span class="px-4 py-2 bg-green-100 text-green-800 rounded-full text-xs lg:text-sm font-semibold">
                ✓ Selesai
            </span>
        </div>

        <!-- ==================== SCORE SUMMARY CARDS ==================== -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <!-- Total Score -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-blue-600 uppercase tracking-widest">Total Skor</p>
                    <i class="fas fa-star text-blue-500 text-lg"></i>
                </div>
                <p class="text-4xl font-bold text-blue-700 mb-1">{{ student.rmib_result.total_score }}</p>
                <p class="text-xs text-blue-600">dari 720 poin maksimal</p>
                <div class="mt-3 w-full bg-blue-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full" style="width: {% widthratio student.rmib_result.total_score 720 100 %}%"></div>
                </div>
            </div>

            <!-- Primary Interest (Level & Score) -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-6 border-2 border-yellow-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-yellow-600 uppercase tracking-widest">Minat Utama</p>
                    <i class="fas fa-medal text-yellow-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-yellow-700 mb-1">{{ student.rmib_result.primary_level }}/12</p>
                <p class="text-xs text-yellow-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-amber-600">{{ student.rmib_result.primary_level|multiply:5 }} poin</p>
            </div>

            <!-- Secondary Interest -->
            {% if student.rmib_result.secondary_level %}
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 border-2 border-purple-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-purple-600 uppercase tracking-widest">Minat Kedua</p>
                    <i class="fas fa-medal text-purple-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-purple-700 mb-1">{{ student.rmib_result.secondary_level }}/12</p>
                <p class="text-xs text-purple-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-indigo-600">{{ student.rmib_result.secondary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}

            <!-- Tertiary Interest -->
            {% if student.rmib_result.tertiary_level %}
            <div class="bg-gradient-to-br from-orange-50 to-rose-50 rounded-xl p-6 border-2 border-orange-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-orange-600 uppercase tracking-widest">Minat Ketiga</p>
                    <i class="fas fa-medal text-orange-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-orange-700 mb-1">{{ student.rmib_result.tertiary_level }}/12</p>
                <p class="text-xs text-orange-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-rose-600">{{ student.rmib_result.tertiary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}
        </div>

        <!-- ==================== TOP 3 INTERESTS DETAILED ==================== -->
        <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-list-ol text-indigo-600 mr-2"></i>
                Top 3 Minat Tertinggi
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Rank 1 -->
                <div class="relative bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl p-5 border-2 border-yellow-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        1
                    </div>
                    
                    <p class="text-sm font-semibold text-yellow-700 mb-1">MINAT UTAMA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:":1" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-yellow-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-amber-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-yellow-200 rounded-full h-3 overflow-hidden">
                                    <div class="bg-yellow-500 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-yellow-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Rank 2 -->
                {% if student.rmib_result.secondary_level %}
                <div class="relative bg-gradient-to-br from-gray-100 to-slate-100 rounded-xl p-5 border-2 border-gray-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        2
                    </div>
                    
                    <p class="text-sm font-semibold text-gray-700 mb-1">MINAT KEDUA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"1:2" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-gray-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-slate-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden">
                                    <div class="bg-gray-600 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Rank 3 -->
                {% if student.rmib_result.tertiary_level %}
                <div class="relative bg-gradient-to-br from-orange-100 to-amber-100 rounded-xl p-5 border-2 border-orange-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        3
                    </div>
                    
                    <p class="text-sm font-semibold text-orange-700 mb-1">MINAT KETIGA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"2:3" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-orange-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-amber-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-orange-300 rounded-full h-3 overflow-hidden">
                                    <div class="bg-orange-600 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-orange-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ==================== TIMESTAMP INFO ==================== -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6 border-l-4 border-blue-500">
            <div class="flex items-start space-x-3">
                <i class="fas fa-calendar-alt text-blue-600 text-lg mt-0.5"></i>
                <div>
                    <p class="text-sm text-blue-800 mb-1">
                        <strong>Tes Diselesaikan:</strong> {{ student.rmib_result.submitted_at|date:"d F Y, H:i" }} WIB
                    </p>
                    {% if student.rmib_result.edited_at %}
                    <p class="text-sm text-blue-800">
                        <strong>Terakhir Diedit:</strong> {{ student.rmib_result.edited_at|date:"d F Y, H:i" }} WIB
                    </p>
                    {% endif %}
                    <p class="text-xs text-blue-600 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Status: <span class="font-bold capitalize">{{ student.rmib_result.get_status_display }}</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- ==================== ACTION BUTTONS ==================== -->
        <div class="flex flex-wrap gap-3 justify-start">
            <!-- View Full Results -->
            <a href="{% url 'students:rmib_result' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 btn-primary text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-eye mr-2"></i>
                Lihat Detail Lengkap
            </a>

            <!-- Edit Results -->
            <a href="{% url 'students:rmib_edit_confirmation' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 btn-warning text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-edit mr-2"></i>
                Edit Hasil
            </a>

            <!-- Print Report -->
            <a href="{% url 'students:rmib_result' student.pk %}" target="_blank"
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-print mr-2"></i>
                Cetak Laporan
            </a>

            <!-- Download (Placeholder) -->
            <button onclick="alert('Fitur download akan segera tersedia')"
                    class="inline-flex items-center px-6 py-2.5 btn-success text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-download mr-2"></i>
                Download
            </button>
        </div>
    </section>

    {% else %}
    <!-- No Results Yet -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                Hasil Tes RMIB
            </h2>
        </div>

        <div class="text-center py-12">
            <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
            <p class="text-xl font-bold text-gray-800 mb-2">Belum Ada Hasil Tes</p>
            <p class="text-gray-600 mb-6">Hasil tes RMIB akan ditampilkan setelah siswa menyelesaikan tes</p>
            
            <div class="flex justify-center gap-4">
                <a href="{% url 'students:rmib_test' student.pk %}" 
                class="inline-flex items-center px-8 py-3 btn-primary text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                    <i class="fas fa-play-circle mr-2"></i>
                    Mulai Tes RMIB
                </a>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- ==================== ACHIEVEMENTS SECTION ==================== -->
    {% if student.achievements.all %}
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-8">
        <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-trophy text-yellow-500 mr-3"></i>
            Prestasi ({{ student.achievements.count }})
        </h2>

        <div class="space-y-4">
            {% for achievement in student.achievements.all %}
            <div class="border-l-4 border-indigo-500 bg-gradient-to-r from-indigo-50 to-white p-4 rounded-lg hover:shadow-md transition-all duration-300">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-900">{{ achievement.achievement_type.name }}</h4>
                        <p class="text-sm text-gray-600">{{ achievement.get_level_display }} • {{ achievement.get_rank_display }}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-900">{{ achievement.points }} poin</p>
                        <p class="text-sm text-gray-600">{{ achievement.year }}</p>
                    </div>
                </div>
                {% if achievement.notes %}
                <p class="text-sm text-gray-700 mt-2 ml-4">{{ achievement.notes }}</p>
                {% endif %}
                {% if achievement.certificate %}
                <div class="mt-2 ml-4">
                    <a href="{{ achievement.certificate.url }}" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 font-semibold">
                        <i class="fas fa-file-pdf mr-1"></i>Lihat Sertifikat
                    </a>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

</div>

<script>
    function copyPassword() {
        const passwordElement = document.getElementById('passwordDisplay');
        const text = passwordElement.textContent.trim();
        navigator.clipboard.writeText(text).then(() => {
            alert('Password berhasil disalin ke clipboard');
        }).catch(() => {
            alert('Gagal menyalin password');
        });
    }

    function resetPasswordConfirm() {
        if (confirm('Apakah Anda yakin ingin mereset password siswa ini? Password akan direset ke nilai default.')) {
            fetch("{% url 'students:reset_password' student.pk %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password berhasil direset!\nPassword baru: ' + data.new_password);
                    location.reload();
                } else {
                    alert('Gagal mereset password: ' + data.message);
                }
            })
            .catch(error => {
                alert('Terjadi kesalahan: ' + error);
            });
        }
    }

    function unlockAccountConfirm() {
        if (confirm('Apakah Anda yakin ingin membuka kunci akun siswa ini?')) {
            fetch("{% url 'students:unlock_account' student.pk %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('Gagal membuka akun: ' + data.message);
                }
            })
            .catch(error => {
                alert('Terjadi kesalahan: ' + error);
            });
        }
    }
</script>

{% endblock %}
