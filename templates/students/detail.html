{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}Detail Siswa - {{ student.name }}{% endblock %}

{% block extra_css %}
<style>
/* ==================== ANIMATIONS ==================== */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
.animate-slideInLeft { animation: slideInLeft 0.5s ease-out forwards; }

/* ==================== CARDS ==================== */
.detail-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid rgba(226, 232, 240, 0.5);
}

.detail-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* ==================== PROGRESS BAR ==================== */
.progress-bar-custom {
    height: 10px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    transition: width 0.5s ease;
}

/* ==================== STATUS BADGE ==================== */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.pending {
    background: #fef3c7;
    color: #92400e;
}

.status-badge.in-progress {
    background: #dbeafe;
    color: #1e40af;
}

.status-badge.completed {
    background: #d1fae5;
    color: #065f46;
}

.status-badge.edited {
    background: #fce7f3;
    color: #831843;
}

/* ==================== ICON CIRCLE ==================== */
.icon-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    flex-shrink: 0;
}

/* ==================== RMIB SECTION ==================== */
.rmib-section {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border: 2px solid rgba(99, 102, 241, 0.2);
    border-radius: 16px;
    padding: 24px;
}

/* ==================== INFO BOX ==================== */
.info-box {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border-left: 4px solid #3b82f6;
    border-radius: 8px;
    padding: 16px;
}

/* ==================== STAT BOX ==================== */
.stat-box {
    text-align: center;
    padding: 16px;
    background: white;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.stat-box .value {
    font-size: 28px;
    font-weight: 700;
    color: #3b82f6;
}

.stat-box .label {
    font-size: 12px;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 6px;
}

/* ==================== BUTTON STYLES ==================== */
.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.btn-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .icon-circle {
        width: 50px;
        height: 50px;
        font-size: 24px;
    }
    
    .detail-card {
        padding: 16px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- ==================== HEADER SECTION ==================== -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-xl p-8 mb-8 text-white animate-fadeInUp">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-6">
                <!-- Profile Picture -->
                <div class="w-24 h-24 lg:w-32 lg:h-32 rounded-full bg-white/20 backdrop-blur-lg flex items-center justify-center">
                    <i class="fas fa-user text-4xl lg:text-5xl"></i>
                </div>
                
                <!-- Student Info -->
                <div>
                    <h1 class="text-3xl lg:text-4xl font-bold mb-2">{{ student.name }}</h1>
                    <p class="text-indigo-100 text-lg">{{ student.get_class_display }}</p>
                    <div class="flex gap-6 mt-3 text-indigo-100">
                        <span><i class="fas fa-id-card mr-2"></i>{{ student.nisn }}</span>
                        <span><i class="fas fa-mars-and-venus mr-2"></i>{{ student.get_gender_display }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Status Badge -->
            <div>
                <span class="status-badge {% if student.test_status == 'pending' %}pending{% elif student.test_status == 'in_progress' %}in-progress{% else %}completed{% endif %}">
                    {% if student.test_status == 'pending' %}
                    <i class="fas fa-hourglass-start"></i> Belum Tes
                    {% elif student.test_status == 'in_progress' %}
                    <i class="fas fa-spinner fa-spin"></i> Sedang Tes
                    {% else %}
                    <i class="fas fa-check-circle"></i> Selesai
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- ==================== PERSONAL DATA SECTION ==================== -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Basic Info -->
        <div class="detail-card p-6 animate-slideInLeft">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-user text-indigo-600 mr-2"></i>Data Pribadi
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Tempat/Tanggal Lahir</p>
                    <p class="text-gray-900 mt-1">{{ student.birth_place }}, {{ student.birth_date|date:"d M Y" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Jenis Kelamin</p>
                    <p class="text-gray-900 mt-1">{{ student.get_gender_display }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Tahun Masuk</p>
                    <p class="text-gray-900 mt-1">{{ student.entry_year }}</p>
                </div>
            </div>
        </div>

        <!-- Contact Info -->
        <div class="detail-card p-6 animate-slideInLeft" style="animation-delay: 0.1s;">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-phone text-indigo-600 mr-2"></i>Kontak
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Nomor Ponsel</p>
                    <p class="text-gray-900 mt-1">{{ student.phone|default:"Tidak Ada" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Ponsel Orang Tua</p>
                    <p class="text-gray-900 mt-1">{{ student.parent_phone|default:"Tidak Ada" }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Alamat</p>
                    <p class="text-gray-900 mt-1 text-sm">{{ student.address|default:"Tidak Ada" }}</p>
                </div>
            </div>
        </div>

        <!-- Academic Info -->
        <div class="detail-card p-6 animate-slideInLeft" style="animation-delay: 0.2s;">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-graduation-cap text-indigo-600 mr-2"></i>Akademik
            </h3>
            <div class="space-y-4">
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Kelas</p>
                    <p class="text-gray-900 mt-1 text-lg font-bold">{{ student.student_class }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">NISN</p>
                    <p class="text-gray-900 mt-1">{{ student.nisn }}</p>
                </div>
                <div>
                    <p class="text-xs text-gray-600 font-semibold">Status Tes</p>
                    <p class="mt-1">
                        <span class="status-badge {% if student.test_status == 'pending' %}pending{% elif student.test_status == 'in_progress' %}in-progress{% else %}completed{% endif %}" style="display: inline-flex;">
                            {% if student.test_status == 'pending' %}
                            Belum Tes
                            {% elif student.test_status == 'in_progress' %}
                            Sedang Tes
                            {% else %}
                            Selesai
                            {% endif %}
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== RMIB TEST SECTION - OPTIMAL ==================== -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                Tes RMIB (Rothwell Miller Interest Blank)
            </h2>
            <span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">
                Status: <span class="font-bold">{{ student.get_test_status_display }}</span>
            </span>
        </div>

        <!-- ==================== STATUS INDICATOR ==================== -->
        {% if student.test_status == 'pending' %}
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-clock text-yellow-600 text-2xl mt-1"></i>
                <div>
                    <h3 class="text-lg font-bold text-yellow-900 mb-2">Belum Memulai Tes</h3>
                    <p class="text-yellow-800 mb-4">
                        Siswa belum memulai tes RMIB. Klik tombol di bawah untuk memulai tes minat dan bakat.
                    </p>
                    <a href="{% url 'students:rmib_test' student.pk %}" 
                    class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-play-circle mr-2"></i>
                        Mulai Tes RMIB
                    </a>
                </div>
            </div>
        </div>

        {% elif student.test_status == 'in_progress' %}
        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border-l-4 border-blue-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-spinner text-blue-600 text-2xl mt-1 animate-spin"></i>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-blue-900 mb-2">Sedang Mengerjakan Tes</h3>
                    <p class="text-blue-800 mb-4">
                        Siswa sedang mengerjakan tes RMIB. Progress otomatis tersimpan setiap 30 detik.
                    </p>
                    <div class="space-y-2">
                        <a href="{% url 'students:rmib_test' student.pk %}" 
                        class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-play-circle mr-2"></i>
                            Lanjutkan Tes
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {% elif student.test_status == 'completed' %}
        <!-- ==================== COMPLETED STATE ==================== -->
        {% if student.rmib_result %}
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 rounded-lg p-6 mb-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-check-circle text-green-600 text-2xl mt-1"></i>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-green-900 mb-1">Tes Selesai</h3>
                    <p class="text-green-800 text-sm">
                        Diselesaikan pada: <strong>{{ student.rmib_result.submitted_at|date:"d F Y, H:i" }} WIB</strong>
                        {% if student.rmib_result.edited_at %}
                        <br>Terakhir diedit: <strong>{{ student.rmib_result.edited_at|date:"d F Y, H:i" }} WIB</strong>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- ==================== RESULTS SUMMARY ==================== -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Total Score -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border-2 border-blue-200">
                <p class="text-xs font-semibold text-blue-600 uppercase tracking-wide mb-1">Total Skor</p>
                <p class="text-3xl font-bold text-blue-700">{{ student.rmib_result.total_score }}</p>
                <p class="text-xs text-blue-600 mt-1">dari 720 poin</p>
            </div>

            <!-- Primary Interest -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 border-2 border-yellow-200">
                <p class="text-xs font-semibold text-amber-600 uppercase tracking-wide mb-1">Minat Utama</p>
                <p class="text-2xl font-bold text-amber-700">Level {{ student.rmib_result.primary_level }}</p>
                <p class="text-xs text-amber-600 mt-1">{{ student.rmib_result.primary_score|default:0 }} poin</p>
            </div>

            <!-- Secondary Interest -->
            {% if student.rmib_result.secondary_level %}
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border-2 border-purple-200">
                <p class="text-xs font-semibold text-purple-600 uppercase tracking-wide mb-1">Minat Kedua</p>
                <p class="text-2xl font-bold text-purple-700">Level {{ student.rmib_result.secondary_level }}</p>
                <p class="text-xs text-purple-600 mt-1">{{ student.rmib_result.secondary_score|default:0 }} poin</p>
            </div>
            {% endif %}

            <!-- Tertiary Interest -->
            {% if student.rmib_result.tertiary_level %}
            <div class="bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl p-4 border-2 border-pink-200">
                <p class="text-xs font-semibold text-pink-600 uppercase tracking-wide mb-1">Minat Ketiga</p>
                <p class="text-2xl font-bold text-pink-700">Level {{ student.rmib_result.tertiary_level }}</p>
                <p class="text-xs text-pink-600 mt-1">{{ student.rmib_result.tertiary_score|default:0 }} poin</p>
            </div>
            {% endif %}
        </div>

        <!-- ==================== TOP 3 INTERESTS CARDS ==================== -->
        <div class="mb-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-medal text-yellow-500 mr-2"></i>
                Top 3 Minat Tertinggi
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Primary -->
                <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-lg p-4 border-2 border-yellow-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            1
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Utama</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:":1" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-yellow-700">{{ student.rmib_result.primary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-orange-600">{{ student.rmib_result.primary_level|multiply:5 }}</span>
                    </div>
                </div>

                <!-- Secondary -->
                {% if student.rmib_result.secondary_level %}
                <div class="bg-gradient-to-br from-gray-100 to-slate-100 rounded-lg p-4 border-2 border-gray-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-gray-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            2
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Kedua</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"1:2" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-gray-700">{{ student.rmib_result.secondary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-gray-600">{{ student.rmib_result.secondary_level|multiply:5 }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Tertiary -->
                {% if student.rmib_result.tertiary_level %}
                <div class="bg-gradient-to-br from-orange-100 to-amber-100 rounded-lg p-4 border-2 border-orange-300">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            3
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Minat Ketiga</p>
                            <p class="font-bold text-gray-900 truncate">
                                {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"2:3" %}
                                    {{ cat_key|upper }}
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Level:</span>
                        <span class="text-2xl font-bold text-orange-700">{{ student.rmib_result.tertiary_level }}/12</span>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-600">Skor:</span>
                        <span class="text-xl font-bold text-amber-600">{{ student.rmib_result.tertiary_level|multiply:5 }}</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ==================== ACTION BUTTONS ==================== -->
        <div class="flex flex-wrap gap-3 justify-start">
            <!-- View Results -->
            <a href="{% url 'students:rmib_result' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-eye mr-2"></i>
                Lihat Detail
            </a>

            <!-- Edit Results -->
            <a href="{% url 'students:rmib_edit_confirmation' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-edit mr-2"></i>
                Edit Hasil
            </a>

            <!-- Download Report -->
            <button onclick="alert('Fitur download report akan segera tersedia')" 
                    class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-download mr-2"></i>
                Download
            </button>

            <!-- Print -->
            <a href="{% url 'students:rmib_result' student.pk %}" target="_blank"
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm lg:text-base">
                <i class="fas fa-print mr-2"></i>
                Cetak
            </a>
        </div>

        {% else %}
        <!-- No Results Yet -->
        <div class="bg-gray-50 rounded-lg p-8 text-center border-2 border-dashed border-gray-300">
            <i class="fas fa-inbox text-gray-400 text-5xl mb-4"></i>
            <p class="text-gray-600 text-lg font-semibold mb-2">Belum Ada Hasil Tes</p>
            <p class="text-gray-500 mb-4">Hasil tes akan muncul setelah siswa menyelesaikan tes RMIB</p>
        </div>
        {% endif %}

        {% endif %}

        <!-- ==================== INFO BOX ==================== -->
        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mt-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-blue-600 text-lg mt-0.5"></i>
                <div>
                    <p class="text-sm text-blue-800">
                        <strong>Tentang RMIB:</strong> Tes RMIB (Rothwell Miller Interest Blank) adalah alat penilaian minat dan bakat siswa terhadap berbagai bidang pekerjaan. 
                        Gunakan hasil tes ini sebagai panduan dalam memilih jurusan dan karir di masa depan.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== RMIB RESULT SECTION - CLEAN & OPTIMAL ==================== -->
    {% if student.rmib_result %}
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-trophy text-yellow-500 mr-3"></i>
                Hasil Tes RMIB
            </h2>
            <span class="px-4 py-2 bg-green-100 text-green-800 rounded-full text-xs lg:text-sm font-semibold">
                ✓ Selesai
            </span>
        </div>

        <!-- ==================== SCORE SUMMARY CARDS ==================== -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <!-- Total Score -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border-2 border-blue-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-blue-600 uppercase tracking-widest">Total Skor</p>
                    <i class="fas fa-star text-blue-500 text-lg"></i>
                </div>
                <p class="text-4xl font-bold text-blue-700 mb-1">{{ student.rmib_result.total_score }}</p>
                <p class="text-xs text-blue-600">dari 720 poin maksimal</p>
                <div class="mt-3 w-full bg-blue-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full" style="width: {% widthratio student.rmib_result.total_score 720 100 %}%"></div>
                </div>
            </div>

            <!-- Primary Interest (Level & Score) -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-6 border-2 border-yellow-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-yellow-600 uppercase tracking-widest">Minat Utama</p>
                    <i class="fas fa-medal text-yellow-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-yellow-700 mb-1">{{ student.rmib_result.primary_level }}/12</p>
                <p class="text-xs text-yellow-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-amber-600">{{ student.rmib_result.primary_level|multiply:5 }} poin</p>
            </div>

            <!-- Secondary Interest -->
            {% if student.rmib_result.secondary_level %}
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-6 border-2 border-purple-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-purple-600 uppercase tracking-widest">Minat Kedua</p>
                    <i class="fas fa-medal text-purple-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-purple-700 mb-1">{{ student.rmib_result.secondary_level }}/12</p>
                <p class="text-xs text-purple-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-indigo-600">{{ student.rmib_result.secondary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}

            <!-- Tertiary Interest -->
            {% if student.rmib_result.tertiary_level %}
            <div class="bg-gradient-to-br from-orange-50 to-rose-50 rounded-xl p-6 border-2 border-orange-200 hover:shadow-lg transition-all duration-300">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-xs font-bold text-orange-600 uppercase tracking-widest">Minat Ketiga</p>
                    <i class="fas fa-medal text-orange-500 text-lg"></i>
                </div>
                <p class="text-3xl font-bold text-orange-700 mb-1">{{ student.rmib_result.tertiary_level }}/12</p>
                <p class="text-xs text-orange-600 mb-2">Level</p>
                <p class="text-2xl font-bold text-rose-600">{{ student.rmib_result.tertiary_level|multiply:5 }} poin</p>
            </div>
            {% endif %}
        </div>

        <!-- ==================== TOP 3 INTERESTS DETAILED ==================== -->
        <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-list-ol text-indigo-600 mr-2"></i>
                Top 3 Minat Tertinggi
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Rank 1 -->
                <div class="relative bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl p-5 border-2 border-yellow-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        1
                    </div>
                    
                    <p class="text-sm font-semibold text-yellow-700 mb-1">MINAT UTAMA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:":1" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-yellow-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-amber-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-yellow-200 rounded-full h-3 overflow-hidden">
                                    <div class="bg-yellow-500 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-yellow-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Rank 2 -->
                {% if student.rmib_result.secondary_level %}
                <div class="relative bg-gradient-to-br from-gray-100 to-slate-100 rounded-xl p-5 border-2 border-gray-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        2
                    </div>
                    
                    <p class="text-sm font-semibold text-gray-700 mb-1">MINAT KEDUA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"1:2" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-gray-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-slate-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden">
                                    <div class="bg-gray-600 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Rank 3 -->
                {% if student.rmib_result.tertiary_level %}
                <div class="relative bg-gradient-to-br from-orange-100 to-amber-100 rounded-xl p-5 border-2 border-orange-300 shadow-md hover:shadow-lg transition-all duration-300">
                    <!-- Badge Rank -->
                    <div class="absolute -top-4 -right-4 w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">
                        3
                    </div>
                    
                    <p class="text-sm font-semibold text-orange-700 mb-1">MINAT KETIGA</p>
                    
                    {% for cat_key, level in student.rmib_result.get_ranking_summary|slice:"2:3" %}
                        <h4 class="text-xl font-bold text-gray-900 mb-3 capitalize">
                            {{ cat_key|title }}
                        </h4>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Level:</span>
                                <span class="text-2xl font-bold text-orange-700">{{ level }}/12</span>
                            </div>
                            
                            <div class="flex justify-between items-center bg-white rounded-lg p-3">
                                <span class="text-sm font-semibold text-gray-700">Skor:</span>
                                <span class="text-2xl font-bold text-amber-600">{{ level|multiply:5 }}</span>
                            </div>
                            
                            <div class="bg-white rounded-lg p-3">
                                <p class="text-xs text-gray-600 mb-2">Progress</p>
                                <div class="w-full bg-orange-300 rounded-full h-3 overflow-hidden">
                                    <div class="bg-orange-600 h-3 rounded-full" style="width: {% widthratio level 12 100 %}%"></div>
                                </div>
                                <p class="text-xs text-orange-600 mt-1">{% widthratio level 12 100 %}% dari maksimal</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ==================== TIMESTAMP INFO ==================== -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6 border-l-4 border-blue-500">
            <div class="flex items-start space-x-3">
                <i class="fas fa-calendar-alt text-blue-600 text-lg mt-0.5"></i>
                <div>
                    <p class="text-sm text-blue-800 mb-1">
                        <strong>Tes Diselesaikan:</strong> {{ student.rmib_result.submitted_at|date:"d F Y, H:i" }} WIB
                    </p>
                    {% if student.rmib_result.edited_at %}
                    <p class="text-sm text-blue-800">
                        <strong>Terakhir Diedit:</strong> {{ student.rmib_result.edited_at|date:"d F Y, H:i" }} WIB
                    </p>
                    {% endif %}
                    <p class="text-xs text-blue-600 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Status: <span class="font-bold capitalize">{{ student.rmib_result.get_status_display }}</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- ==================== ACTION BUTTONS ==================== -->
        <div class="flex flex-wrap gap-3 justify-start">
            <!-- View Full Results -->
            <a href="{% url 'students:rmib_result' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-eye mr-2"></i>
                Lihat Detail Lengkap
            </a>

            <!-- Edit Results -->
            <a href="{% url 'students:rmib_edit_confirmation' student.pk %}" 
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-edit mr-2"></i>
                Edit Hasil
            </a>

            <!-- Print Report -->
            <a href="{% url 'students:rmib_result' student.pk %}" target="_blank"
            class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-print mr-2"></i>
                Cetak Laporan
            </a>

            <!-- Download (Placeholder) -->
            <button onclick="alert('Fitur download akan segera tersedia')"
                    class="inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
                <i class="fas fa-download mr-2"></i>
                Download
            </button>
        </div>
    </section>

    {% else %}
    <!-- No Results Yet -->
    <section class="bg-white rounded-2xl shadow-lg p-6 lg:p-8 mb-6">
        <div class="flex items-center justify-between mb-6 pb-4 border-b-2 border-gray-200">
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                Hasil Tes RMIB
            </h2>
        </div>

        <div class="text-center py-12">
            <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
            <p class="text-xl font-bold text-gray-800 mb-2">Belum Ada Hasil Tes</p>
            <p class="text-gray-600 mb-6">Hasil tes RMIB akan ditampilkan setelah siswa menyelesaikan tes</p>
            
            <div class="flex justify-center gap-4">
                <a href="{% url 'students:rmib_test' student.pk %}" 
                class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                    <i class="fas fa-play-circle mr-2"></i>
                    Mulai Tes RMIB
                </a>
            </div>
        </div>
    </section>
    {% endif %}


     <!-- ==================== PRESTASI SECTION ==================== -->
    {% if student.prestasi.all %}
    <div class="detail-card p-6 animate-slideInLeft" style="animation-delay: 0.4s;">
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-trophy text-yellow-500 mr-3"></i>
            Prestasi ({{ student.prestasi.count }})
        </h2>

        <div class="space-y-4">
            {% for prestasi in student.prestasi.all %}
            <div class="border-l-4 border-indigo-500 bg-gradient-to-r from-indigo-50 to-white p-4 rounded-lg">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-3">
                            <i class="fas {{ prestasi.get_jenis_icon }} text-lg {{ prestasi.get_tingkat_display_color }}"></i>
                            <div>
                                <h4 class="font-bold text-gray-900">{{ prestasi.nama }}</h4>
                                <p class="text-sm text-gray-600">{{ prestasi.get_jenis_display }} • {{ prestasi.get_tingkat_display }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-900">{{ prestasi.peringkat }}</p>
                        <p class="text-sm text-gray-600">{{ prestasi.tahun }}</p>
                    </div>
                </div>
                {% if prestasi.keterangan %}
                <p class="text-sm text-gray-700 mt-2 pl-9">{{ prestasi.keterangan }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>

<script>
    function downloadRMIBReport() {
        alert('Fitur download report akan segera tersedia.');
        // TODO: Implement PDF download
    }
</script>
{% endblock %}
