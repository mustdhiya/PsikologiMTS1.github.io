{% extends 'base.html' %}
{% load static %}

{% block title %}Hasil Tes RMIB - {{ student.name }}{% endblock %}

{% block extra_css %}
<style>
/* ==================== ANIMATIONS ==================== */
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes scaleIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
.animate-slideInLeft { animation: slideInLeft 0.5s ease-out forwards; }
.animate-scaleIn { animation: scaleIn 0.4s ease-out forwards; }

.delay-100 { animation-delay: 0.1s; }
.delay-200 { animation-delay: 0.2s; }
.delay-300 { animation-delay: 0.3s; }
.delay-400 { animation-delay: 0.4s; }
.delay-500 { animation-delay: 0.5s; }

/* ==================== CARD DESIGN ==================== */
.result-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border: 1px solid rgba(226, 232, 240, 0.8);
}

.result-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
}

/* ==================== RANK BADGE ==================== */
.rank-badge {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-weight: bold;
    color: white;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.rank-badge.rank-1 {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
}

.rank-badge.rank-2 {
    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
}

.rank-badge.rank-3 {
    background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
}

/* ==================== PROGRESS BAR ==================== */
.score-bar {
    height: 12px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.score-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
    border-radius: 10px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.score-bar-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* ==================== CATEGORY LIST ==================== */
.category-item {
    padding: 18px;
    background: white;
    border-radius: 12px;
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
}

.category-item:hover {
    transform: translateX(8px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    border-left-color: #764ba2;
}

/* ==================== ICON CIRCLE ==================== */
.icon-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* ==================== INFO BOX ==================== */
.info-box {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border-left: 4px solid #3b82f6;
    border-radius: 8px;
    padding: 16px;
    transition: all 0.3s ease;
}

.info-box:hover {
    border-left-color: #764ba2;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
}

/* ==================== PRINT STYLES ==================== */
@media print {
    .no-print { display: none !important; }
    .result-card { 
        box-shadow: none; 
        border: 1px solid #e5e7eb;
        page-break-inside: avoid;
    }
    body { background: white; }
    header { page-break-after: avoid; }
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .rank-badge {
        width: 60px;
        height: 60px;
        font-size: 28px;
    }
    
    .category-item {
        padding: 14px;
        flex-wrap: wrap;
    }
    
    .icon-circle {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- ==================== HEADER SECTION ==================== -->
    <header class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-2xl shadow-2xl p-8 lg:p-12 mb-8 text-white animate-fadeInUp">
        <div class="text-center">
            <!-- Trophy Icon -->
            <div class="inline-flex items-center justify-center w-20 h-20 lg:w-24 lg:h-24 bg-white/20 backdrop-blur-lg rounded-full shadow-lg mb-4 lg:mb-6">
                <i class="fas fa-trophy text-4xl lg:text-5xl"></i>
            </div>
            
            <!-- Title -->
            <h1 class="text-3xl lg:text-5xl font-bold mb-2">Hasil Tes RMIB</h1>
            <p class="text-base lg:text-lg text-indigo-100 mb-4 lg:mb-6">Rothwell Miller Interest Blank Assessment</p>
            
            <!-- Student Info -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl px-6 lg:px-8 py-3 lg:py-4 inline-block">
                <p class="text-indigo-100 text-xs lg:text-sm">Nama Siswa</p>
                <p class="text-2xl lg:text-3xl font-bold mb-2">{{ student.name }}</p>
                <div class="flex flex-wrap justify-center gap-4 lg:gap-6 text-indigo-100 text-sm lg:text-base">
                    <span><i class="fas fa-id-card mr-1"></i>{{ student.nisn }}</span>
                    <span><i class="fas fa-chalkboard mr-1"></i>{{ student.student_class }}</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ==================== SUCCESS MESSAGE ==================== -->
    <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl shadow-lg p-6 mb-8 text-center animate-scaleIn">
        <i class="fas fa-check-circle text-4xl lg:text-5xl mb-3"></i>
        <h2 class="text-xl lg:text-2xl font-bold mb-2">Selamat! Tes Berhasil Diselesaikan</h2>
        <p class="text-sm lg:text-base text-green-50">Berikut adalah hasil analisis minat dan bakat karir Anda berdasarkan Tes RMIB</p>
    </div>

    <!-- ==================== TOTAL SCORE HIGHLIGHT ==================== -->
    <div class="result-card p-6 lg:p-8 mb-8 animate-slideInLeft">
        <div class="text-center">
            <p class="text-gray-600 text-base lg:text-lg mb-2">
                <i class="fas fa-star text-yellow-500 mr-2"></i>Total Skor Anda
            </p>
            <div class="text-5xl lg:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-2">
                {{ total_score }}
            </div>
            <p class="text-sm lg:text-base text-gray-600">
                dari maksimal 720 poin (12 kategori × level 12 × 5)
            </p>
        </div>
    </div>

    <!-- ==================== TOP 3 INTERESTS ==================== -->
    <div class="result-card p-6 lg:p-8 mb-8 animate-slideInLeft delay-100">
        <h2 class="text-xl lg:text-3xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-medal text-yellow-500 mr-3"></i>
            Top 3 Minat Dominan Anda
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for interest in categories|slice:":3" %}
            <div class="relative group animate-scaleIn delay-{{ forloop.counter }}00">
                <div class="bg-gradient-to-br from-white to-gray-50 border-2 
                    {% if forloop.counter == 1 %}border-yellow-400{% elif forloop.counter == 2 %}border-gray-400{% else %}border-orange-400{% endif %} 
                    rounded-xl p-6 text-center transform transition-all duration-300 group-hover:scale-105 group-hover:shadow-2xl">
                    
                    <!-- Rank Badge -->
                    <div class="flex justify-center mb-4">
                        <div class="rank-badge rank-{{ interest.rank }}">
                            {{ interest.rank }}
                        </div>
                    </div>

                    <!-- Category Name -->
                    <h3 class="text-base lg:text-lg font-bold text-gray-900 mb-2">{{ interest.category_name }}</h3>

                    <!-- Level Display -->
                    <div class="flex items-center justify-center space-x-2 mb-4">
                        <span class="text-3xl lg:text-4xl font-bold text-indigo-600">{{ interest.level }}</span>
                        <span class="text-sm text-gray-500">/12</span>
                    </div>

                    <!-- Score Display -->
                    <div class="text-center mb-4">
                        <p class="text-sm text-gray-600 mb-1">Skor Kategori</p>
                        <p class="text-2xl lg:text-3xl font-bold text-green-600">{{ interest.score }}</p>
                    </div>

                    <!-- Progress Bar -->
                    <div class="score-bar">
                        <div class="score-bar-fill" style="width: {% widthratio interest.score 60 100 %}%;"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">{% widthratio interest.score 60 100 %}% dari maksimal</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ==================== ALL CATEGORIES RANKING ==================== -->
    <div class="result-card p-6 lg:p-8 mb-8 animate-slideInLeft delay-200">
        <h2 class="text-xl lg:text-3xl font-bold text-gray-900 mb-6 flex items-center">
            <i class="fas fa-list-ol text-blue-600 mr-3"></i>
            Peringkat Semua Kategori
        </h2>

        <div class="space-y-3">
            {% for cat in categories %}
            <div class="category-item">
                <!-- Rank Number -->
                <div class="text-xl lg:text-2xl font-bold text-indigo-600 w-8 lg:w-10 text-center flex-shrink-0">
                    #{{ cat.rank }}
                </div>

                <!-- Icon Circle -->
                <div class="icon-circle flex-shrink-0" style="background: linear-gradient(135deg, {% if cat.rank == 1 %}#fbbf24, #f59e0b{% elif cat.rank == 2 %}#94a3b8, #64748b{% elif cat.rank == 3 %}#fb923c, #f97316{% else %}#3b82f6, #8b5cf6{% endif %});">
                    <i class="fas {{ cat.icon }} text-white"></i>
                </div>

                <!-- Category Info -->
                <div class="flex-1 min-w-0">
                    <h4 class="font-bold text-gray-900 text-sm lg:text-base">{{ cat.category_name }}</h4>
                    <p class="text-xs lg:text-sm text-gray-600">Level {{ cat.level }}/12</p>
                </div>

                <!-- Score -->
                <div class="text-right flex-shrink-0">
                    <p class="text-xl lg:text-2xl font-bold text-green-600">{{ cat.score }}</p>
                    <p class="text-xs text-gray-500">poin</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ==================== ANALYSIS SECTION ==================== -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Primary Interest Analysis -->
        <div class="result-card p-6 lg:p-8 animate-slideInLeft delay-300">
            <h3 class="text-lg lg:text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-star text-yellow-500 mr-2"></i>
                Minat Utama Anda
            </h3>
            <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg p-6 border-2 border-yellow-200">
                <p class="text-sm lg:text-base text-gray-600 mb-2">Kategori Dominan:</p>
                <p class="text-2xl lg:text-3xl font-bold text-gray-900 mb-3">{{ primary_interest }}</p>
                <div class="flex items-center space-x-4">
                    <div>
                        <p class="text-xs lg:text-sm text-gray-600">Level</p>
                        <p class="text-xl lg:text-2xl font-bold text-indigo-600">{{ primary_level }}/12</p>
                    </div>
                    <div class="text-gray-300 text-2xl lg:text-4xl">•</div>
                    <div>
                        <p class="text-xs lg:text-sm text-gray-600">Skor</p>
                        <p class="text-xl lg:text-2xl font-bold text-green-600">{% widthratio primary_level 1 5 %}</p>
                    </div>
                </div>
                <p class="text-xs text-gray-600 mt-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    Ini adalah kategori dengan tingkat kesesuaian tertinggi terhadap minat Anda
                </p>
            </div>
        </div>

        <!-- Score Distribution -->
        <div class="result-card p-6 lg:p-8 animate-slideInLeft delay-400">
            <h3 class="text-lg lg:text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                Statistik Skor
            </h3>
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm lg:text-base text-gray-700 font-semibold">Total Skor</span>
                        <span class="text-xl lg:text-2xl font-bold text-indigo-600">{{ total_score }}</span>
                    </div>
                    <div class="text-xs text-gray-500">Jumlah semua level × 5</div>
                </div>
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm lg:text-base text-gray-700 font-semibold">Rata-rata Level</span>
                        <span class="text-xl lg:text-2xl font-bold text-green-600">{% widthratio total_score 60 1 %}</span>
                    </div>
                    <div class="text-xs text-gray-500">Total skor ÷ 60</div>
                </div>
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm lg:text-base text-gray-700 font-semibold">Skor Tertinggi</span>
                        <span class="text-xl lg:text-2xl font-bold text-yellow-600">{{ categories.0.score }}</span>
                    </div>
                    <div class="text-xs text-gray-500">{{ categories.0.category_name }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== INFO & NOTES ==================== -->
    <div class="space-y-4 mb-8">
        <div class="info-box animate-slideInLeft delay-500">
            <div class="flex items-start space-x-3">
                <i class="fas fa-lightbulb text-blue-600 text-lg lg:text-xl mt-1 flex-shrink-0"></i>
                <div>
                    <p class="font-bold text-gray-900 text-sm lg:text-base">Tips Menggunakan Hasil Tes</p>
                    <p class="text-xs lg:text-sm text-gray-700 mt-1">
                        Hasil tes RMIB ini menunjukkan tingkat kesesuaian minat Anda untuk setiap bidang karir. 
                        Gunakan hasil ini sebagai panduan dalam memilih jurusan dan karir di masa depan. 
                        Diskusikan dengan guru BK atau orang tua untuk menggali lebih dalam.
                    </p>
                </div>
            </div>
        </div>

        <div class="info-box animate-slideInLeft delay-500">
            <div class="flex items-start space-x-3">
                <i class="fas fa-calendar-alt text-blue-600 text-lg lg:text-xl mt-1 flex-shrink-0"></i>
                <div>
                    <p class="font-bold text-gray-900 text-sm lg:text-base">Waktu Pengerjaan</p>
                    <p class="text-xs lg:text-sm text-gray-700 mt-1">
                        Tes diselesaikan pada: <strong>{{ rmib_result.submitted_at|date:"d F Y, H:i" }} WIB</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ACTION BUTTONS ==================== -->
    <div class="flex flex-wrap justify-center gap-3 lg:gap-4 no-print mb-8">
        <!-- Edit Button - NEW -->
        <a href="{% url 'students:rmib_edit_confirmation' student.pk %}" 
        class="inline-flex items-center px-6 lg:px-8 py-2.5 lg:py-3 bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white text-sm lg:text-base font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-edit mr-2"></i>
            Edit Hasil
        </a>
        
        <button onclick="window.print()" 
                class="inline-flex items-center px-6 lg:px-8 py-2.5 lg:py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white text-sm lg:text-base font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-print mr-2"></i>
            Cetak Hasil
        </button>
        
        <a href="{% url 'students:detail' student.pk %}" 
        class="inline-flex items-center px-6 lg:px-8 py-2.5 lg:py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white text-sm lg:text-base font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-user mr-2"></i>
            Profil Siswa
        </a>
        
        <a href="{% url 'students:list' %}" 
        class="inline-flex items-center px-6 lg:px-8 py-2.5 lg:py-3 bg-gray-600 hover:bg-gray-700 text-white text-sm lg:text-base font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-list mr-2"></i>
            Daftar Siswa
        </a>
    </div>

    <!-- Edit Status Info - NEW -->
    {% if rmib_result.status == 'edited' %}
    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 mb-4">
        <p class="text-sm text-blue-700">
            <i class="fas fa-info-circle mr-2"></i>
            <strong>Hasil Ter-edit:</strong> Terakhir diperbarui pada {{ rmib_result.edited_at|date:"d F Y, H:i" }} WIB
        </p>
    </div>
    {% endif %}


    <!-- ==================== FOOTER NOTE ==================== -->
    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-xl p-6 text-center">
        <p class="text-gray-700 text-xs lg:text-sm">
            <i class="fas fa-shield-alt text-indigo-600 mr-2"></i>
            Data hasil tes ini bersifat privat dan hanya dapat diakses oleh pemilik akun dan admin sistem
        </p>
        <p class="text-xs text-gray-500 mt-3">
            © 2025 Sistem Penilaian Minat RMIB - MTs Muhammadiyah 1 Samarinda
        </p>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    // Console log untuk verification
    console.log('✅ RMIB Result Page Loaded');
    console.log('📊 Total Score:', {{ total_score }});
    console.log('👤 Student:', '{{ student.name|escapejs }}');
    console.log('📝 Primary Interest:', '{{ primary_interest|escapejs }}');
    console.log('🎯 Primary Level:', {{ primary_level }});
    
    // Auto-scroll to top on load
    window.scrollTo({ top: 0, behavior: 'smooth' });
</script>
{% endblock %}
